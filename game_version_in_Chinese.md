# PG规划

PG是一个2D横版像素风格的生存游戏，目标是建造各种设施，独自一人在怪物林立的末世中活下去，最终击败 boss，或者被怪物击败。

## 内容

### 人物设计

- **携带**：左手右手可以各拿一样东西，小腿、大腿、腰上、背上、双臂上各有一个安装栏，可以用来安装在那个位置可以安装的东西(比如背上的背包、小腿上绑着的刀)。但是装上的东西会影响到移动速度，胳膊上的以及手上拿的还会影响开采、攻击效率，所有的都会加快体力消耗速度。

- **数值**：一共有体力(饥饿)、保暖度、口渴度、健康值四种。其中体力会随着运动逐渐降低，而体力越低，运动越慢，体力为0则心脏区域开始扣血。保暖度是身体的温度，是身体每一块单独使用的，比如左胳膊单独使用左胳膊的保暖度；保暖度合适，则那一块躯体工作效率高，反之则低，极致则减血；保暖度受温度、衣物和体力的共同影响。口渴度只要喝水就能增加，随时间逐渐减小，当太大或者太小时会降低运动效率，甚至危害健康。健康值很简单，比如胳膊的健康没了，就是胳膊不能用了，腿断了一根，就只能拖着腿走了。

### 地图设计

土、树、石头、矿什么的。

各种各样可以探索的地形(前期可以只有两个)。

## 实现

- 用Tile实现地图，Tile只是用来绘图的，并没有其他功能。每种Tile有一个编号，当需要交互的时候，通过编号查找Tile交互对应的事件。大地图存储在硬盘里，主角移动到下一个渲染范围(一般都是窗口大小)时，由内存里的一个小地图(数组)先将主角周围三个窗口大小内的地图摘取下来备用渲染，有一个线程专门做这件事。绘图的时候，渲染所有可见的tile和UI。每个Tile都有一个和相邻的Tile不一样的编号，用以区分周围的Tile(默认是 1 ～ 9)，如下。

  |  1   |  2   |  3   |  1   |  2   |  3   |  1   |  2   |  3   |
  | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
  |  4   |  5   |  6   |  4   |  5   |  6   |  4   |  5   |  6   |
  |  7   |  8   |  9   |  7   |  8   |  9   |  7   |  8   |  9   |
  |  1   |  2   |  3   |  1   |  2   |  3   |  1   |  2   |  3   |
  |  4   |  5   |  6   |  4   |  5   |  6   |  4   |  5   |  6   |
  |  7   |  8   |  9   |  7   |  8   |  9   |  7   |  8   |  9   |
  |  1   |  2   |  3   |  1   |  2   |  3   |  1   |  2   |  3   |
  |  4   |  5   |  6   |  4   |  5   |  6   |  4   |  5   |  6   |
  |  7   |  8   |  9   |  7   |  8   |  9   |  7   |  8   |  9   |

  

- 游戏的进行是随时间进行的。每刷新一次为一游戏刻，每可设置的x游戏刻为一分钟，60分钟为一小时，24小时为一天。

- 每游戏刻，先获取游戏事件，再对游戏中每个对象进行设置，最后清除屏幕，再根据每个对象的状态设置屏幕。

- 相机跟随，移动到主角 x 游戏刻前所在的位置就可以了。

- 存囊系统，设置为像 *暗黑破坏神2* 那样的，有实际大小的。

- 各个事件随后再一一实现。

- 地图生成器随后实现

- 怪物移动、攻击判定随后实现

- 各种特殊互动物品随后实现

- 游戏存储文件：

  - 文件头(不变信息)：标记 PGsave，地图高(uint32_t)，地图宽(uint32_t)，地图种子号(uint64_t)，创建时间精确到秒(uint32_t)，创建版本(uint32_t)
  - 文件变量：游戏难度(uint8_t)，进行时长单位秒(uint64_t)，最新运行版本(uint32_t)，世界数量(uint8_t)，包括房主的登入玩家数量(uint32_t)

  - 世界一 tile 序列：每个tile用一个 uint32_t 大小储存 sign ，依次排开。

  - 世界二 tile 序列

  - ……

  - 世界n tile 序列

  - 玩家信息：

    - 房主：id(固定长度字符串，字数未定)，上次登录时间(uint32_t)，上次登录版本(uint32_t)，玩家身体状态信息，上次退出时周围单位如怪物等(未定列表)，[boss激活状态(uint32_t)]

    - 客户玩家一：id(固定长度字符串，字数未定)，上次登录时间(uint32_t)，上次登录版本(uint32_t)，玩家身体状态信息

  - 额外附加信息

  - 游戏配置文件：

  - 文件头(不变信息)：标记 PGconfiguration

  - 文件变量：游戏版本(uint32_t)，窗口高(uint32_t)，窗口宽(uint32_t)，游戏渲染大小(uint8_t)，全屏游戏否(bool:uint8_t)，游戏本体地址长度(uint32_t)，游戏tile库地址长度(uint32_t)，游戏脚本库地址(uint32_t)

  - 游戏本体地址：char类型的串

  - 游戏tile库地址

  - 游戏脚本库地址
